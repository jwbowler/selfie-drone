<script src="hls.min.js"></script>
<script src="canvas-to-blob.min.js"></script>
<!-- <script src="FileSaver.min.js"></script> -->
<script src="download.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>

<video id="video">
<!-- <source src=".mp4" /> -->
</video>

<button id="capture">Capture</button>

<div id="output"></div>

<script>
(function() {
    "use strict";

    if(Hls.isSupported()) {
        var video = document.getElementById('video');
        var hls = new Hls();
        hls.loadSource('http://www.streambox.fr/playlists/test_001/stream.m3u8');
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED,function() {
            video.play();
        });
    }

    var video, $output;
    var scale = 1;

    var initialize = function() {
        $output = $("#output");
        video = $("#video").get(0);
        $("#capture").click(captureImage);
    };

    var captureImage = function() {
        var canvas = document.createElement("canvas");
        canvas.width = video.videoWidth * scale;
        canvas.height = video.videoHeight * scale;
        canvas.getContext('2d')
            .drawImage(video, 0, 0, canvas.width, canvas.height);

        var img = document.createElement("img");
        img.src = canvas.toDataURL();
        console.log(img.src)
        $output.prepend(img);

        canvas.toBlob(function(blob) {
            download(blob, "screenshot.png");
            console.log("Boom");
        });
    };

    $(initialize);

}());
</script>
